<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Type Classes · Blindsight</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link rel="canonical" href="/blindsight/usage/typeclasses.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
1.1.0
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a>
  <ul>
    <li><a href="../setup/logstash.html" class="page">Logback with Logstash</a></li>
    <li><a href="../setup/generic.html" class="page">Generic</a></li>
  </ul></li>
  <li><a href="../usage/index.html" class="page">Usage</a>
  <ul>
    <li><a href="../usage/overview.html" class="page">Overview</a></li>
    <li><a href="../usage/resolvers.html" class="page">Logger Resolvers</a></li>
    <li><a href="../usage/dsl.html" class="page">Structured DSL</a></li>
    <li><a href="../usage/typeclasses.html" class="active page">Type Classes</a></li>
    <li><a href="../usage/slf4j.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="page">Flow API</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
    <li><a href="../usage/context.html" class="page">Contextual Logging</a></li>
    <li><a href="../usage/sourcecode.html" class="page">Source Code</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a>
  <ul>
    <li><a href="../extending/overview.html" class="page">Overview</a></li>
  </ul></li>
  <li><a href="../principles.html" class="page">Principles</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Blindsight</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
1.1.0
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a>
  <ul>
    <li><a href="../setup/logstash.html" class="page">Logback with Logstash</a></li>
    <li><a href="../setup/generic.html" class="page">Generic</a></li>
  </ul></li>
  <li><a href="../usage/index.html" class="page">Usage</a>
  <ul>
    <li><a href="../usage/overview.html" class="page">Overview</a></li>
    <li><a href="../usage/resolvers.html" class="page">Logger Resolvers</a></li>
    <li><a href="../usage/dsl.html" class="page">Structured DSL</a></li>
    <li><a href="../usage/typeclasses.html" class="active page">Type Classes</a></li>
    <li><a href="../usage/slf4j.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="page">Flow API</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
    <li><a href="../usage/context.html" class="page">Contextual Logging</a></li>
    <li><a href="../usage/sourcecode.html" class="page">Source Code</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a>
  <ul>
    <li><a href="../extending/overview.html" class="page">Overview</a></li>
  </ul></li>
  <li><a href="../principles.html" class="page">Principles</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Blindsight</a></li>
  <li><a href="../usage/index.html">Usage</a></li>
  <li>Type Classes</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#type-classes" name="type-classes" class="anchor"><span class="anchor-link"></span></a>Type Classes</h1>
<p>The important types in Blindsight are <a href="/blindsight/api/com/tersesystems/blindsight/Markers.html" title="com.tersesystems.blindsight.Markers"><code>Markers</code></a>, <a href="/blindsight/api/com/tersesystems/blindsight/Argument.html" title="com.tersesystems.blindsight.Argument"><code>Argument</code></a>, and <a href="/blindsight/api/com/tersesystems/blindsight/Message.html" title="com.tersesystems.blindsight.Message"><code>Message</code></a>.</p>
<p>Where possible, the APIs map automatically, using the <a href="/blindsight/api/com/tersesystems/blindsight/ToMarkers.html" title="com.tersesystems.blindsight.ToMarkers"><code>ToMarkers</code></a>, <a href="/blindsight/api/com/tersesystems/blindsight/ToMessage.html" title="com.tersesystems.blindsight.ToMessage"><code>ToMessage</code></a> and <a href="/blindsight/api/com/tersesystems/blindsight/ToArgument.html" title="com.tersesystems.blindsight.ToArgument"><code>ToArgument</code></a> type classes, respectively.</p>
<h2><a href="#general-principles" name="general-principles" class="anchor"><span class="anchor-link"></span></a>General Principles</h2>
<p>Type classes let you represent your domain objects as structured logging data. </p>
<p>Although Blindsight does provide mappings of the basic primitive types, you may want to provide some more semantic detail about what the value represents, and use the DSL with a specific field name and type &ndash; for example, rather than representing an age as an integer, <code>logger.info(&quot;person age = {}&quot;, persion.age)</code> is easier if you use a specific class <code>Age</code> and have a type class instance that represents that <code>Age</code> as <code>bobj(&quot;age_year&quot; -&gt; ageInYear)</code></p>
<h2><a href="#markers" name="markers" class="anchor"><span class="anchor-link"></span></a>Markers</h2>
<p>You can pass in something that is not a marker, and provided you have a <a href="/blindsight/api/com/tersesystems/blindsight/ToMarkers.html" title="com.tersesystems.blindsight.ToMarkers"><code>ToMarkers</code></a> in implicit scope, you can get it auto-converted through type annotation. The various logging statement will only take a <a href="/blindsight/api/com/tersesystems/blindsight/Markers.html" title="com.tersesystems.blindsight.Markers"><code>Markers</code></a>:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/test/scala/example/typeclasses/TypeClassExample.scala#L13-L14" target="_blank" title="Go to snippet source"></a><code class="language-scala">val marker = MarkerFactory.getDetachedMarker(&quot;SOME_MARKER&quot;)
logger.info(Markers(marker), &quot;message with marker&quot;)</code></pre>
<p>You can also combine markers:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/test/scala/example/typeclasses/TypeClassExample.scala#L18-L20" target="_blank" title="Go to snippet source"></a><code class="language-scala">val markers1: Markers          = Markers(MarkerFactory.getDetachedMarker(&quot;MARKER1&quot;))
val markers2: Markers          = Markers(MarkerFactory.getDetachedMarker(&quot;MARKER2&quot;))
val markersOnePlusTwo: Markers = markers1 + markers2</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>You should <strong>not</strong> try to manipulate the marker through <code>marker.add</code> or <code>marker.remove</code>. It&rsquo;s better to treat a <code>org.slf4j.Marker</code> instance as completely immutable, and manage any composition through <a href="/blindsight/api/com/tersesystems/blindsight/Markers.html" title="com.tersesystems.blindsight.Markers"><code>Markers</code></a>.</p></div>
<p>Getting at the underlying marker is a <code>lazy val</code> that is computed once:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/test/scala/example/typeclasses/TypeClassExample.scala#L24" target="_blank" title="Go to snippet source"></a><code class="language-scala">val combinedMarker: org.slf4j.Marker = markersOnePlusTwo.marker</code></pre>
<p>You can also convert your own objects into appropriate markers.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/test/scala/example/typeclasses/TypeClassExample.scala#L28-L38" target="_blank" title="Go to snippet source"></a><code class="language-scala">sealed trait Weekday {
  def value: String
}
final case object Monday extends Weekday { val value = &quot;MONDAY&quot; }
object Weekday {
  implicit def weekday2Marker(weekday: Weekday): Markers = Markers(weekday)
  implicit val toMarkers: ToMarkers[Weekday] = ToMarkers { weekday =&gt;
    Markers(MarkerFactory.getDetachedMarker(weekday.value))
  }
}
logger.debug(Monday, &quot;this is a test&quot;)</code></pre>
<p>The SLF4J API is awkward to use with markers, because there are several possible variations that can confuse the compiler and stop the type class from being used directly. To avoid using the <code>Markers(marker)</code> wrapper, you can use the <a href="fluent.html">fluent API</a> or use <a href="context.html">contextual logging</a>.</p>
<h2><a href="#argument-and-arguments" name="argument-and-arguments" class="anchor"><span class="anchor-link"></span></a>Argument and Arguments</h2>
<p>Arguments must be convertible to <a href="/blindsight/api/com/tersesystems/blindsight/Argument.html" title="com.tersesystems.blindsight.Argument"><code>Argument</code></a>. This is usually done with type class instances.</p>
<p>Default <a href="/blindsight/api/com/tersesystems/blindsight/ToArgument.html" title="com.tersesystems.blindsight.ToArgument"><code>ToArgument</code></a> are determined for the primitives (<code>String</code>, <code>Int</code>, etc):</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/test/scala/example/typeclasses/TypeClassExample.scala#L42" target="_blank" title="Go to snippet source"></a><code class="language-scala">logger.info(&quot;one argument {}&quot;, 42) // works, because default</code></pre>
<p>You can define your own argument type class instances:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/test/scala/example/typeclasses/TypeClassExample.scala#L46-L50" target="_blank" title="Go to snippet source"></a><code class="language-scala">import java.time.temporal.ChronoUnit
implicit val chronoUnitToArgument: ToArgument[ChronoUnit] = ToArgument[ChronoUnit] { unit =&gt;
  new Argument(unit.toString)
}
logger.info(&quot;chronounit is {}&quot;, ChronoUnit.MILLIS)</code></pre>
<p>Although it&rsquo;s usually better to use the <a href="dsl.html">DSL</a> and map to a <a href="/blindsight/api/com/tersesystems/blindsight/AST$$BObject.html" title="com.tersesystems.blindsight.AST.BObject"><code>BObject</code></a>:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/test/scala/example/typeclasses/TypeClassExample.scala#L54-L59" target="_blank" title="Go to snippet source"></a><code class="language-scala">case class Person(name: String, age: Int)
implicit val personToArgument: ToArgument[Person] = ToArgument[Person] { person =&gt;
  import DSL._
  Argument((&quot;name&quot; -&gt; person.name) ~ (&quot;age_year&quot; -&gt; person.age))
}
logger.info(&quot;person is {}&quot;, Person(&quot;steve&quot;, 12))</code></pre>
<p>There is a plural of <a href="/blindsight/api/com/tersesystems/blindsight/Argument.html" title="com.tersesystems.blindsight.Argument"><code>Argument</code></a>, <a href="/blindsight/api/com/tersesystems/blindsight/Arguments.html" title="com.tersesystems.blindsight.Arguments"><code>Arguments</code></a> that is used in place of varadic arguments. If you have more than two arguments, you will need to wrap them so they are provided as a single <a href="/blindsight/api/com/tersesystems/blindsight/Arguments.html" title="com.tersesystems.blindsight.Arguments"><code>Arguments</code></a> instance:</p>
<pre class="prettyprint"><code class="language-scala">logger.info(&quot;arg {}, arg {}, arg {}&quot;, Arguments(1, &quot;2&quot;, false))
</code></pre>
<h2><a href="#message" name="message" class="anchor"><span class="anchor-link"></span></a>Message</h2>
<p>The <a href="/blindsight/api/com/tersesystems/blindsight/Message.html" title="com.tersesystems.blindsight.Message"><code>Message</code></a> is usually a String, but it doesn&rsquo;t have to be. Using the <a href="/blindsight/api/com/tersesystems/blindsight/ToMessage.html" title="com.tersesystems.blindsight.ToMessage"><code>ToMessage</code></a> type class, you can convert any class into a message. This is probably most appropriate with string-like classes like <code>CharSequence</code> and <code>akka.util.ByteString</code>.</p>
<pre class="prettyprint"><code class="language-scala">implicit val toMessage: ToMessage[CharSequence] = ToMessage[CharSequence] { charSeq =&gt;
  new Message(charSeq.toString)
}
val charSeq: CharSequence = new ArrayCharSequence(Array(&#39;1&#39;, &#39;2&#39;, &#39;3&#39;))
logger.fluent.info.message(charSeq).log()
</code></pre>
<h2><a href="#custom-json-mappings" name="custom-json-mappings" class="anchor"><span class="anchor-link"></span></a>Custom JSON Mappings</h2>
<p>You can pass through JSON directly if you already have it and recreating it through the DSL would be a waste.</p>
<p>For example, if you are working with json4s or play-json, you can convert to Jackson JsonNode using a type class:</p>
<pre class="prettyprint"><code class="language-scala">import com.fasterxml.jackson.databind.JsonNode

trait ToJsonNode[T] {
  def jsonNode(instance: T): JsonNode
}

object ToJsonNode {
  import org.json4s._

  implicit val json4sToJsonNode: ToJsonNode[JValue] = new ToJsonNode[JValue] {
    import org.json4s.jackson.JsonMethods._
    override def jsonNode(instance: JValue): JsonNode = asJsonNode(instance)
  }
}
</code></pre>
<p>And then set up your own type mappings as follows:</p>
<pre class="prettyprint"><code class="language-scala">implicit def jsonToArgument[T: ToJsonNode]: ToArgument[(String, T)] = ToArgument {
  case (k, instance) =&gt;
    val node = implicitly[ToJsonNode[T]].jsonNode(instance)
    Argument(StructuredArguments.keyValue(k, node)) // or raw(k, node.toPrettyString)
}

import org.json4s._
import org.json4s.jackson.JsonMethods._

logger.info(&quot;This message has json {}&quot;, parse(&quot;&quot;&quot; { &quot;numbers&quot; : [1, 2, 3, 4] } &quot;&quot;&quot;))
</code></pre>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/tersesystems/blindsight/tree/v1.1.0/docs/src/main/paradox/usage/typeclasses.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../usage/slf4j.html">SLF4J API</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../usage/typeclasses.html#type-classes" class="header">Type Classes</a>
  <ul>
    <li><a href="../usage/typeclasses.html#general-principles" class="header">General Principles</a></li>
    <li><a href="../usage/typeclasses.html#markers" class="header">Markers</a></li>
    <li><a href="../usage/typeclasses.html#argument-and-arguments" class="header">Argument and Arguments</a></li>
    <li><a href="../usage/typeclasses.html#message" class="header">Message</a></li>
    <li><a href="../usage/typeclasses.html#custom-json-mappings" class="header">Custom JSON Mappings</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2020</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '1.1.0', 'https://tersesystems.github.io/blindsight')});</script>


</html>
